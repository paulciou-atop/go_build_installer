name: Build Windows Installer 
on: push
  
jobs:
  Setting-running-env:
    runs-on: windows-latest
    steps:
      - name: Checkout Repository Code
        uses: actions/checkout@v3
        
      - uses: actions/setup-go@v3
        with:
          go-version: '^1.18.0' # The Go version to download (if necessary) and use.
      - run: go version
      - name: install tools
        run: |
          choco source add -n=mh-cbon -s="https://api.bintray.com/nuget/mh-cbon/choco"
          #choco install changelog gh-api-cli -y 
          choco install go-msi 
          dir "C:\Program Files\go-msi"
          choco install wixtoolset
          refreshenv
          set GH_APP=%APPVEYOR_PROJECT_NAME%
          set GH_USER=%APPVEYOR_ACCOUNT_NAME%
          set VERSION=%APPVEYOR_REPO_TAG_NAME%
          set VERSION=1.0.2        
          set PATH=%PATH%;"C:\Program Files\go-msi\" 
          
          
           
      - name: build source code
        run: | 
          cd source
          
          set GOARCH=amd64
          go build -o listen13380.exe --ldflags "-X main.VERSION=%VERSION%" main.go
          dir 
          cd ..
          COPY source\listen13380.exe exefile\
          dir exefile\
      - name: build installer
        run: |
          go-msi check-env
          "C:\Program Files\go-msi\go-msi.exe make --msi nms.%VERSION%.msi --version %VERSION%"
          dir 
          
          
    
  

      
